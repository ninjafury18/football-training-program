<script>
  const DEFAULT_SYMBOLS = ['<<', '>>', 'â—']; // full solid circle

  let symbols = [...DEFAULT_SYMBOLS];
  let colors = ['#39ff14'];

  const symbolEl = document.getElementById('symbol');
  const toggleBtn = document.getElementById('toggleBtn');
  const intervalSelect = document.getElementById('intervalSelect');
  const modeSelect = document.getElementById('modeSelect');
  const soundToggleBtn = document.getElementById('soundToggleBtn');
  const controlsDiv = document.getElementById('controls');

  let intervalId = null;
  let running = false;
  let lastSymbol = null;
  let repeatCount = 0;
  let soundOn = false;

  const clickAudio = new Audio('mixkit-cool-interface-click-tone-2568.wav');

  function unlockAudio() {
    clickAudio.play().catch(() => {});
  }

  function getNextSymbol() {
    let next;

    do {
      next = symbols[Math.floor(Math.random() * symbols.length)];
    } while (next === lastSymbol && repeatCount >= 4);

    if (next === lastSymbol) {
      repeatCount++;
    } else {
      repeatCount = 1;
      lastSymbol = next;
    }

    return next;
  }

  function showSymbol() {
    if (symbols.length === 0) return;

    const sym = getNextSymbol();
    symbolEl.textContent = sym;

    // ðŸ”¹ DEFAULT MODE circle 40% larger
    if (modeSelect.value === 'default' && sym === 'â—') {
      symbolEl.style.fontSize = 'calc(min(142vw, 142vh) * 1.4)';
    } else {
      symbolEl.style.fontSize = 'min(142vw, 142vh)';
    }

    const colorIndex = Math.floor(Math.random() * colors.length);
    symbolEl.style.color = colors[colorIndex];

    if (soundOn) {
      const a = clickAudio.cloneNode();
      a.play().catch(() => {});
    }
  }

  function restartInterval() {
    clearInterval(intervalId);
    intervalId = setInterval(showSymbol, Number(intervalSelect.value));
  }

  function startTraining() {
    if (running) return;
    running = true;
    controlsDiv.style.opacity = '0.1';
    showSymbol();
    restartInterval();
    toggleBtn.textContent = 'Stop';
  }

  function stopTraining() {
    running = false;
    controlsDiv.style.opacity = '1';
    clearInterval(intervalId);
    intervalId = null;
    lastSymbol = null;
    repeatCount = 0;
    symbolEl.textContent = '';
    toggleBtn.textContent = 'Start';
  }

  toggleBtn.addEventListener('click', () => {
    unlockAudio();
    running ? stopTraining() : startTraining();
  });

  intervalSelect.addEventListener('change', () => {
    if (running) restartInterval();
  });

  modeSelect.addEventListener('change', () => {
    if (modeSelect.value === 'default') {
      symbols = [...DEFAULT_SYMBOLS];
      colors = ['#39ff14'];
    } else {
      const symInput = prompt('Enter your symbols separated by commas');
      if (symInput) {
        symbols = symInput
          .split(',')
          .map(s => s.trim())
          .filter(Boolean)
          .map(s => {
            // ðŸ”¹ Convert any "O" (upper/lowercase) to solid circle
            return s.toLowerCase() === 'o' ? 'â—' : s;
          });
      }

      const colorInput = prompt('Enter colours separated by commas');
      if (colorInput) {
        colors = colorInput
          .split(',')
          .map(c => c.trim())
          .filter(Boolean);
      }
    }
  });

  soundToggleBtn.addEventListener('click', () => {
    unlockAudio();
    soundOn = !soundOn;
    soundToggleBtn.textContent = 'Sound: ' + (soundOn ? 'On' : 'Off');
  });
</script>
